const handler = async (m, { conn }) => {
  const cooldown = 600_000; // 10 ุฏูุงุฆู
  const now = Date.now();
  const res = await m.db.query('SELECT exp, lastwork FROM usuarios WHERE id = $1', [m.sender]);
  const user = res.rows[0];
  const lastWork = Number(user?.lastwork) || 0;
  const remaining = Math.max(0, lastWork + cooldown - now);

  if (remaining > 0) {
    return conn.reply(m.chat, `โณ ุนููู ุฃู ุชุฑุชุงุญ ููุฏุฉ *${msToTime(remaining)}* ูุจู ุฃู ุชุนูู ูุฑุฉ ุฃุฎุฑู.`, m);
  }

  const xpGained = Math.floor(Math.random() * 6500);
  await m.db.query('UPDATE usuarios SET exp = exp + $1, lastwork = $2 WHERE id = $3', [xpGained, now, m.sender]);
  await conn.reply(m.chat, `๐ ${pickRandom(work)} *${formatNumber(xpGained)} ุฎุจุฑุฉ*`, m);
};

handler.help = ['ุนูู'];
handler.tags = ['ุงูุชุตุงุฏ'];
handler.command = /^ุนูู$/i;
handler.register = true;

export default handler;

function msToTime(duration) {
  const totalSeconds = Math.floor(duration / 1000);
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  return `${minutes} ุฏูููุฉ ${seconds} ุซุงููุฉ`;
}

function pickRandom(list) {
  return list[Math.floor(Math.random() * list.length)];
}

function formatNumber(num) {
  return num.toLocaleString('ar-EG');
}

const work = [
  'ุฃูุช ุฎูููุงุฆู ูุงูุฑุ ุชุตูุน ุฌุฑุนุงุช ุบุงูุถุฉ ูุงูุชุดุงู ุงูุฃุณุฑุงุฑ ุงููุฏููุฉ. ุญุตูุช ุนูู',
  'ุชุจุญุซ ุนู ุงููููุฒ ูู ุฃูุงูู ููุณูุฉ ูุชูุชุดู ุซุฑูุฉ ูุฎููุฉ. ุญุตูุช ุนูู',
  'ุชููู ุจุญุฑุงุณุฉ ูุฌููุนุงุช ุงูุจูุช ูุชูุณุจ ููุงุจู ุฌููุฏู',
  'ุชุณุงุนุฏ ูู ุฅุฏุงุฑุฉ ูุฌููุนุฉ GataBot ูุชูุงูุฃ ุจู',
  'ุชุณุงุนุฏ ูู ุฅุฏุงุฑุฉ ูุฌููุนุฉ LoliBot ูุชุญุตู ุนูู',
  'ุชุนูู ูุฏู ุดุฑูุฉ ุฃูููุฉ ุฎุงุตุฉ ูุชูุณุจ',
  'ุชูุธู ููุฑุฌุงู ูุจูุฐ ูุงุฎุฑ ูุชุฑุจุญ',
  'ุชุฏุฑุจ ุงูุชูุงููู ูุชูุณุจ ููุงุฑุงุช ููุนุฑูุฉ. ุญุตูุช ุนูู',
  'ุชุตุจุญ ุญุฏุงุฏูุง ุฃุณุทูุฑููุง ูุชุตูุน ุฃุณูุญุฉ ูุฑูุฏุฉ. ุญุตูุช ุนูู',
  'ุชูุชุดู ุบุงุจุฉ ุณุญุฑูุฉ ูุชุชูุงุตู ูุน ุงูุทุจูุนุฉ. ุญุตูุช ุนูู',
  'ุชุฑูุถ ูุญูุดูุง ุดุฑุณุฉ ุจุงุณุชุฎุฏุงู ูุฏุฑุงุชู. ุญุตูุช ุนูู',
  'ุชุณุงูุฑ ุนุจุฑ ุงูุฒูู ูุชุญู ูุดุงูู ุชุงุฑูุฎูุฉ. ุญุตูุช ุนูู',
  'ุชููู ูุณุชุดุงุฑูุง ูููููุง ูุชูุฌู ุงูุญูุงู. ุญุตูุช ุนูู',
  'ุชุจุชูุฑ ุชูููููุฌูุง ุซูุฑูุฉ ูุชุบูุฑ ุงูุนุงูู. ุญุตูุช ุนูู',
  'ุชุณุญุฑ ุงููุงุณ ุจููุงุฑุงุชู ูู ุงูุฅููุงุน ูุงูุฐูุงุก. ุญุตูุช ุนูู',
  'ุชููุฏ ุฑูุจูุชูุง ุนููุงููุง ูู ูุนุงุฑู ูุฐููุฉ. ุญุตูุช ุนูู',
  'ุชุฏูุฑ ูุฒุฑุนุฉ ุชูุงููู ูุชุนุชูู ุจูุง. ุญุตูุช ุนูู',
  'ุชุนูู ุฌุงุณูุณูุง ูุชูุดู ูุคุงูุฑุงุช. ุญุตูุช ุนูู',
  'ุชุณุชูุดู ุงููุถุงุก ูุชูุชุดู ุฃุณุฑุงุฑ ุงูููู. ุญุตูุช ุนูู',
  'ุชูุงุฑุณ ุงูุณุญุฑ ูุชุคุฏู ุนุฑูุถูุง ูุฐููุฉ. ุญุตูุช ุนูู',
  'ุนุงูู ูุฌููู ูุฎุชุฑุน ุฃุดูุงุก ุบุฑูุจุฉ. ุญุตูุช ุนูู',
  'ุชุญูู ุงูููููุฉ ูู ุงูุบุฒุงุฉ. ุญุตูุช ุนูู',
  'ุชุจุญุฑ ูู ุงูุจุญุงุฑ ูุชูุชุดู ุฌุฒุฑูุง ูููุฆุฉ ุจุงููููุฒ. ุญุตูุช ุนูู',
  'ุชุชุญุฑู ูู ุงูุธู ูุชููู ุจููุงู ุณุฑูุฉ. ุญุตูุช ุนูู',
  'ุทุงูู ุจุงุฑุน ูุจุชูุฑ ุฃุทุจุงููุง ูุฐูุฐุฉ. ุญุตูุช ุนูู',
  'ุชุญูู ูู ุงูุฌุฑุงุฆู ูุชูุดู ุงูุญูุงุฆู. ุญุตูุช ุนูู',
  'ุชูุงูุถ ูุน ุงูุฏูู ูุชุญุงูุธ ุนูู ุงูุณูุงู. ุญุตูุช ุนูู',
  'ุชููู ุดุงูุงููุง ูุชุณุชุฏุนู ุงูุทุงูุงุช ุงูุฑูุญูุฉ. ุญุตูุช ุนูู',
  'ุชุจุชูุฑ ุชุทุจููุงุช ุณุญุฑูุฉ ุชุบูุฑ ุญูุงุฉ ุงููุงุณ. ุญุตูุช ุนูู',
  'ุชุญุงุฑุจ ูู ุจุทููุงุช ูุชุซุจุช ููุงุฑุงุชู. ุญุตูุช ุนูู',
  'ุชุตูู ูุฏููุง ูุณุชูุจููุฉ ูุฐููุฉ. ุญุตูุช ุนูู',
  'ุชูุฑุฃ ุงูุนููู ูุชุชูุจุฃ ุจุงููุณุชูุจู. ุญุตูุช ุนูู',
  'ูุฎุฑุฌ ุณูููุงุฆู ูุจุฏุน ุฃููุงููุง ููุญููุฉ. ุญุตูุช ุนูู',
  'ุชูุชุดู ูููุจูุง ุฌุฏูุฏูุง ูู ุงููุถุงุก. ุญุตูุช ุนูู',
  'ุฎุจูุฑ ูู ุงูุจูุงุก ูุชุบูุจ ุนูู ุงูุฃุฎุทุงุฑ. ุญุตูุช ุนูู',
  'ุชุนุฒู ุงูููุณููู ุฃูุงู ุฌูููุฑ ูุจูุฑ. ุญุตูุช ุนูู',
  'ุชุณุชูุดู ุฃุนูุงู ุงูุจุญุฑ ูุชุฌุฏ ูููุฒูุง. ุญุตูุช ุนูู',
  'ุชุตูู ุฃุฒูุงุก ูุชุจุชูุฑ ุตูุญุงุช ุฌุฏูุฏุฉ. ุญุตูุช ุนูู',
  'ุชุจุฏุฃ ุซูุฑุฉ ูุชููุฏ ุงูุดุนูุจ ููุญุฑูุฉ. ุญุตูุช ุนูู',
  'ุชูุชุดู ุนูุงุฌูุง ูููุฐ ุงูุฃุฑูุงุญ. ุญุตูุช ุนูู',
  'ูุงูุฑ ููุดู ุฃุณุฑุงุฑูุง ุฑูููุฉ. ุญุตูุช ุนูู',
  'ุชูุชุดู ูุจุงุชุงุช ูุงุฏุฑุฉ ุจุฎุตุงุฆุต ุนุฌูุจุฉ. ุญุตูุช ุนูู',
  'ุชุญูู ูู ุงูุฃุณุงุทูุฑ ูุชูุดู ุญูููุชูุง. ุญุตูุช ุนูู',
  'ุชููุจ ุนู ุญุถุงุฑุงุช ูุฏููุฉ ูุชูุดู ุฃุณุฑุงุฑูุง. ุญุตูุช ุนูู',
  'ููุช ูุน ุงููุดุฑู. ุญุตูุช ุนูู',
  'ูุงุนุจ ูุญุชุฑู ูุญูู ุงูุงูุชุตุงุฑุงุช ูู ุงูุจุทููุงุช. ุญุตูุช ุนูู',
];
